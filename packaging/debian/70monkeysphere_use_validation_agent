# /etc/X11/Xsession.d/70monkeysphere_use_validation_agent

# This is a script to be sourced by Xsession.  It wraps the session
# startup argument with a monkeysphere-validation-agent nested
# process, if available and none already exist.

# Enable this system-wide by adding a line to
# /etc/X11/Xsession.options that reads:
# use-monkeysphere-validation-agent

# Note that there is some weird interaction between this and
# dbus-session at the moment: dbus-launch can start the msva just
# fine, but if msva tries to start dbus-launch, dbus-launch fails
# with:

# Failed to waitpid() for babysitter intermediate process: No child processes

# So this is placed at position 70 -- *before* the dbus Xsession
# startup script, which is at 75 as of 2010-03-12, when i wrote this.

# Author: Daniel Kahn Gillmor <dkg@fifthhorseman.net>

STARTMSVA=
MSVAGENT=/usr/bin/monkeysphere-validation-agent

if grep -qs ^use-monkeysphere-validation-agent "$OPTIONFILE"; then
  if [ -x "$MSVAGENT" ] && [ -z "$MONKEYSPHERE_VALIDATION_AGENT_SOCKET" ]; then
    STARTUP="$MSVAGENT $STARTUP"
  fi
fi
